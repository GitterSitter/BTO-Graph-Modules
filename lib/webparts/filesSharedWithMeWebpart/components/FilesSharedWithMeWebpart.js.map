{"version":3,"sources":["webparts/filesSharedWithMeWebpart/components/FilesSharedWithMeWebpart.tsx"],"names":[],"mappings":"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","file":"webparts/filesSharedWithMeWebpart/components/FilesSharedWithMeWebpart.js","sourcesContent":["import * as React from 'react';\r\nimport styles from './FilesSharedWithMeWebpart.module.scss';\r\nimport { IFilesSharedWithMeWebpartProps } from './IFilesSharedWithMeWebpartProps';\r\nimport { IFilesSharedWithMeWebartState } from \"./IFilesSharedWithMeWebartState\";\r\nimport * as jQuery from \"jQuery\";\r\nimport * as moment from 'moment';\r\n\r\nconst tenantUrl = \"https://bergento.sharepoint.com\";\r\n\r\nexport default class FilesSharedWithMeWebpart extends React.Component<IFilesSharedWithMeWebpartProps, IFilesSharedWithMeWebartState> {\r\n\r\n  getCurrentUserLoginName(success, failure) {\r\n\r\n        var query = tenantUrl + \"/_api/web/currentuser\";\r\n        // Get currentUserLoginName\r\n        jQuery.ajax({\r\n            url: query,\r\n            method: \"GET\",\r\n            headers: { \"Accept\": \"application/json; odata=minimalmetadata\" },\r\n            success: function (data) {\r\n                success(data.Email);\r\n              //success(data.LoginName.split('|')[2]);\r\n            },\r\n            error: function (data) {\r\n               failure(data);\r\n            }\r\n        });\r\n}\r\nsetFilesSharedWithUserToState(){\r\nvar that = this;\r\n var filesresult = Array<{Author, Path, LastModifiedTimeMoment, LastModifiedTime, Title}>();  \r\n  this.getCurrentUserLoginName(function(loginName){\r\n    //var query = tenantUrl + \"/_api/search/query?querytext='(SharedWithUsersOWSUSER:dag.finne@bergento.com)'\";\r\n    var query = tenantUrl + \"/_api/search/query?querytext='(SharedWithUsersOWSUSER:\"+ loginName +\")'\";\r\n    \r\n        jQuery.ajax({\r\n            url: query, \r\n            method: \"GET\",\r\n            headers: { \"Accept\": \"application/json\" }, \r\n            success: function (data) {\r\n                var files = data.PrimaryQueryResult.RelevantResults.Table.Rows;  \r\n                \r\n                if (files !== \"\")\r\n                {    \r\n                  files.forEach(element => {\r\n                      var table = element.Cells;\r\n                      var result = {\r\n                        \"Author\": table.filter(d => d.Key === \"Author\")[0].Value.replace(';', ', '),\r\n                        \"Path\": table.filter(d => d.Key === \"ServerRedirectedURL\")[0].Value,\r\n                        \"LastModifiedTimeMoment\" : moment(table.filter(d => d.Key === \"LastModifiedTime\")[0].Value).format(\"DD.MM.YYYY\"),\r\n                        \"LastModifiedTime\": table.filter(d => d.Key === \"LastModifiedTime\")[0].Value,\r\n                        \"Title\": table.filter(d => d.Key === \"Title\")[0].Value\r\n                    };\r\n\r\n                  //No data from test-environment is interesting! && result.Path.toString().indexOf(tenantUrl+\"/sites/pobto\") < 0?\r\n                  if (result.Path.toString().indexOf(tenantUrl+\"/gatewaytest\") < 0 )\r\n                    filesresult.push(result);\r\n                  });\r\n\r\n                  filesresult = filesresult.sort(function(a,b){\r\n                    return (a.LastModifiedTime < b.LastModifiedTime) ? 1 : -1;                    \r\n                  });\r\n                  filesresult = filesresult.slice(0, 19); \r\n                  that.setState({...that.state, files: filesresult});\r\n                }          \r\n            },\r\n            error: function (data) {                \r\n                 console.log(\"Error: \" + data);\r\n            }\r\n                \r\n        });\r\n         \r\n  }, function(data){\r\n    console.log(\"Error: \" + data);\r\n  });\r\n}\r\n\r\n    constructor(){\r\n    super();\r\n    this.state = {\r\n      files: Array<{Author, Path, LastModifiedTimeMoment, LastModifiedTime, Title}>()\r\n    }\r\n  }\r\n\r\n  public componentWillMount(){     \r\n    this.setFilesSharedWithUserToState();\r\n  }\r\n \r\n \r\n  render(){    \r\n    //if (this.state.files.length > 0){\r\n    var thisFiles = this.state.files.map(file =>{\r\n        return(           \r\n           <div className={styles.row} key={`${file.Title}key`}>\r\n             <div className={styles.cell}><a href={file.Path}>{file.Title}</a></div>\r\n             <div className={styles.cell}>{file.Author}</div>\r\n             <div className={styles.cell}>{file.LastModifiedTimeMoment}</div>\r\n           </div>                 \r\n        );\r\n        });\r\n    return(\r\n      this.state.files !== null && this.state.files.length > 0?\r\n      <div className={styles.filesSharedWithMeWebpart}>\r\n        <div className={styles.container}>          \r\n            <div className={styles.table}>\r\n              <div className={styles.thead}>\r\n                <header className={styles.cell}>File</header>\r\n                <header className={styles.cell}>Author</header>\r\n                <header className={styles.cell}>Last modified</header>\r\n              </div>                             \r\n              {thisFiles}              \r\n              </div>              \r\n            </div>          \r\n      </div>\r\n      : <div></div>\r\n    );\r\n  }\r\n}\r\n"],"sourceRoot":"..\\..\\..\\..\\src"}